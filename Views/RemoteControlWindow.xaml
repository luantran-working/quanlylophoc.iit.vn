<Window x:Class="ClassroomManagement.Views.RemoteControlWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Điều khiển từ xa"
        Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        KeyDown="Window_KeyDown">

    <Border CornerRadius="8" Background="#1E1E1E" BorderBrush="#333" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="5" Color="Black" Opacity="0.4"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header Bar -->
            <Border Grid.Row="0" Background="#2D2D2D" CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid Margin="16,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="RemoteDesktop" Width="24" Height="24"
                                                  Foreground="{StaticResource AppPrimaryBrush}" VerticalAlignment="Center"/>
                        <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                            <TextBlock x:Name="TitleText" Text="Điều khiển: Học sinh"
                                       FontSize="14" FontWeight="Bold" Foreground="White"/>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <Ellipse x:Name="StatusDot" Width="8" Height="8" Fill="#4CAF50" VerticalAlignment="Center"/>
                                <TextBlock x:Name="StatusText" Text="Đang kết nối..."
                                           FontSize="11" Foreground="#9E9E9E" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Connection Stats -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Border Background="#333" CornerRadius="4" Padding="8,4" Margin="8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Speedometer" Width="14" Height="14" Foreground="#4CAF50" VerticalAlignment="Center"/>
                                <TextBlock x:Name="FpsText" Text="FPS: --" FontSize="11" Foreground="#9E9E9E" Margin="6,0,0,0"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#333" CornerRadius="4" Padding="8,4" Margin="8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="TimerOutline" Width="14" Height="14" Foreground="#FF9800" VerticalAlignment="Center"/>
                                <TextBlock x:Name="LatencyText" Text="Latency: -- ms" FontSize="11" Foreground="#9E9E9E" Margin="6,0,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                Foreground="#9E9E9E" Width="30" Height="30"
                                ToolTip="Thu nhỏ" Click="MinimizeButton_Click">
                            <materialDesign:PackIcon Kind="WindowMinimize" Width="16" Height="16"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                Foreground="#9E9E9E" Width="30" Height="30"
                                ToolTip="Toàn màn hình (F11)" Click="FullscreenButton_Click">
                            <materialDesign:PackIcon x:Name="FullscreenIcon" Kind="Fullscreen" Width="16" Height="16"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                Foreground="#EF5350" Width="30" Height="30"
                                ToolTip="Đóng (Esc)" Click="CloseButton_Click">
                            <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Toolbar -->
            <Border Grid.Row="1" Background="#252525" Padding="12,8" BorderBrush="#333" BorderThickness="0,0,0,1">
                <StackPanel Orientation="Horizontal">
                    <!-- Back Button -->
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Foreground="#9E9E9E" BorderBrush="#555"
                            Height="32" Padding="12,0" Margin="0,0,8,0"
                            Click="Back_Click" ToolTip="Quay lại">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ArrowLeft" Width="16" Height="16" VerticalAlignment="Center"/>
                            <TextBlock Text="Quay lại" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Separator Style="{StaticResource MaterialDesignSeparator}" Margin="8,0"/>

                    <!-- Control Toggle -->
                    <ToggleButton x:Name="ControlToggle" IsChecked="True"
                                  Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                  ToolTip="Bật/Tắt điều khiển"
                                  Checked="ControlToggle_Changed" Unchecked="ControlToggle_Changed"/>
                    <TextBlock Text="Điều khiển" Foreground="#9E9E9E" FontSize="12"
                               VerticalAlignment="Center" Margin="8,0,16,0"/>

                    <!-- Lock Input Button -->
                    <ToggleButton x:Name="LockInputBtn"
                                  Style="{StaticResource MaterialDesignFlatPrimaryToggleButton}"
                                  Width="36" Height="36" Margin="4,0"
                                  Checked="LockInput_Changed" Unchecked="LockInput_Changed"
                                  ToolTip="Khóa input học sinh">
                        <materialDesign:PackIcon Kind="Lock" Width="18" Height="18"/>
                    </ToggleButton>

                    <!-- Refresh Button -->
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="#9E9E9E" Width="36" Height="36" Margin="4,0"
                            Click="Refresh_Click" ToolTip="Làm mới kết nối">
                        <materialDesign:PackIcon Kind="Refresh" Width="18" Height="18"/>
                    </Button>

                    <!-- Virtual Keyboard Button -->
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="#9E9E9E" Width="36" Height="36" Margin="4,0"
                            Click="VirtualKeyboard_Click" ToolTip="Bàn phím ảo">
                        <materialDesign:PackIcon Kind="Keyboard" Width="18" Height="18"/>
                    </Button>

                    <Separator Style="{StaticResource MaterialDesignSeparator}" Margin="8,0"/>

                    <!-- Screenshot Button -->
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="#9E9E9E" Width="36" Height="36" Margin="4,0"
                            Click="Screenshot_Click" ToolTip="Chụp màn hình (Ctrl+S)">
                        <materialDesign:PackIcon Kind="Camera" Width="18" Height="18"/>
                    </Button>

                    <!-- Send File Button -->
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="#9E9E9E" Width="36" Height="36" Margin="4,0"
                            Click="SendFile_Click" ToolTip="Gửi file">
                        <materialDesign:PackIcon Kind="FileDocument" Width="18" Height="18"/>
                    </Button>

                    <Separator Style="{StaticResource MaterialDesignSeparator}" Margin="8,0"/>

                    <!-- Quality Selector -->
                    <TextBlock Text="Chất lượng:" Foreground="#9E9E9E" FontSize="12"
                               VerticalAlignment="Center" Margin="8,0,8,0"/>
                    <ComboBox x:Name="QualityCombo" Width="100" FontSize="12"
                              SelectionChanged="Quality_Changed"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}">
                        <ComboBoxItem Content="Thấp" Tag="30"/>
                        <ComboBoxItem Content="Trung bình" Tag="50" IsSelected="True"/>
                        <ComboBoxItem Content="Cao" Tag="70"/>
                        <ComboBoxItem Content="Tối đa" Tag="90"/>
                    </ComboBox>
                </StackPanel>
            </Border>

            <!-- Remote Screen Display -->
            <Grid Grid.Row="2" Background="#111" ClipToBounds="True">
                <!-- Screen Image -->
                <Image x:Name="RemoteScreen"
                       Stretch="Uniform"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       MouseMove="RemoteScreen_MouseMove"
                       MouseDown="RemoteScreen_MouseDown"
                       MouseUp="RemoteScreen_MouseUp"
                       MouseWheel="RemoteScreen_MouseWheel"/>

                <!-- Connecting Overlay -->
                <Border x:Name="ConnectingOverlay" Background="#CC111111">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True" Width="48" Height="48"
                                     Foreground="{StaticResource AppPrimaryBrush}"/>
                        <TextBlock x:Name="ConnectingText" Text="Đang kết nối..."
                                   FontSize="14" Foreground="#9E9E9E"
                                   HorizontalAlignment="Center" Margin="0,16,0,0"/>
                    </StackPanel>
                </Border>

                <!-- No Signal Placeholder -->
                <Border x:Name="NoSignalOverlay" Background="#111" Visibility="Collapsed">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="MonitorOff" Width="64" Height="64"
                                                  Foreground="#555" HorizontalAlignment="Center"/>
                        <TextBlock Text="Không có tín hiệu" FontSize="16"
                                   Foreground="#555" HorizontalAlignment="Center" Margin="0,12,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Control Disabled Indicator -->
                <Border x:Name="ViewOnlyBanner" Visibility="Collapsed"
                        Background="#80FF9800" VerticalAlignment="Top"
                        HorizontalAlignment="Center" Padding="16,4" CornerRadius="0,0,8,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Eye" Width="16" Height="16" Foreground="White" VerticalAlignment="Center"/>
                        <TextBlock Text="Chế độ chỉ xem" Foreground="White" FontSize="12"
                                   FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Status Bar -->
            <Border Grid.Row="3" Background="#252525" Padding="12,8" CornerRadius="0,0,8,8" BorderBrush="#333" BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock x:Name="InfoText" Grid.Column="0"
                               Text="Sẵn sàng điều khiển"
                               FontSize="12" Foreground="#9E9E9E" VerticalAlignment="Center"/>

                    <TextBlock x:Name="ResolutionText" Grid.Column="1"
                               Text="Resolution: --"
                               FontSize="11" Foreground="#666" VerticalAlignment="Center" Margin="16,0"/>

                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <TextBlock Text="Phím tắt:" FontSize="11" Foreground="#666" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Esc: Thoát | F11: Fullscreen | Ctrl+S: Screenshot"
                                   FontSize="11" Foreground="#555" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
