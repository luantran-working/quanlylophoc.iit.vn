# BÃ¬nh chá»n Thá»i gian Thá»±c (Polling)

## Tá»•ng quan

TÃ­nh nÄƒng cho phÃ©p giÃ¡o viÃªn táº¡o cuá»™c bÃ¬nh chá»n/kháº£o sÃ¡t vÃ  há»c sinh vote theo thá»i gian thá»±c. Káº¿t quáº£ Ä‘Æ°á»£c cáº­p nháº­t ngay láº­p tá»©c.

## CÃ¡c tÃ­nh nÄƒng

### 1. Táº¡o Poll (GiÃ¡o viÃªn)
- Nháº­p cÃ¢u há»i
- ThÃªm cÃ¡c lá»±a chá»n (A, B, C, D...)
- Chá»n loáº¡i: Single choice hoáº·c Multiple choice
- TÃ¹y chá»n hiá»ƒn thá»‹ káº¿t quáº£ cho há»c sinh

### 2. Vote (Há»c sinh)
- Nháº­n popup khi cÃ³ poll má»›i
- Chá»n Ä‘Ã¡p Ã¡n vÃ  gá»­i
- Xem káº¿t quáº£ (náº¿u Ä‘Æ°á»£c phÃ©p)

### 3. Káº¿t quáº£ Realtime (GiÃ¡o viÃªn)
- Biá»ƒu Ä‘á»“ cáº­p nháº­t theo thá»i gian thá»±c
- Sá»‘ lÆ°á»£ng Ä‘Ã£ vote
- Pháº§n trÄƒm má»—i lá»±a chá»n

## Giao diá»‡n

### Táº¡o Poll (GiÃ¡o viÃªn)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Táº¡o BÃ¬nh chá»n Má»›i                          Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CÃ¢u há»i:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CÃ¡c em Ä‘Ã£ hiá»ƒu bÃ i hÃ´m nay chÆ°a?             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  Loáº¡i: â—‰ Chá»n má»™t   â—‹ Chá»n nhiá»u                   â”‚
â”‚                                                     â”‚
â”‚  Lá»°A CHá»ŒN:                                         â”‚
â”‚  [A] [Hiá»ƒu rÃµ                    ] [âŒ]            â”‚
â”‚  [B] [Hiá»ƒu má»™t pháº§n              ] [âŒ]            â”‚
â”‚  [C] [ChÆ°a hiá»ƒu                  ] [âŒ]            â”‚
â”‚  [D] [Cáº§n giáº£i thÃ­ch thÃªm        ] [âŒ]            â”‚
â”‚                        [+ ThÃªm lá»±a chá»n]           â”‚
â”‚                                                     â”‚
â”‚  â˜‘ Hiá»ƒn thá»‹ káº¿t quáº£ cho há»c sinh                   â”‚
â”‚                                                     â”‚
â”‚              [Táº¡o vÃ  Báº¯t Ä‘áº§u]    [Há»§y]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Káº¿t quáº£ Realtime (GiÃ¡o viÃªn)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Káº¿t quáº£ BÃ¬nh chá»n                    ğŸ”´ LIVE  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  CÃ¡c em Ä‘Ã£ hiá»ƒu bÃ i hÃ´m nay chÆ°a?                  â”‚
â”‚                                                     â”‚
â”‚  A. Hiá»ƒu rÃµ                                         â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 55% (11)         â”‚
â”‚                                                     â”‚
â”‚  B. Hiá»ƒu má»™t pháº§n                                   â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 25% (5)          â”‚
â”‚                                                     â”‚
â”‚  C. ChÆ°a hiá»ƒu                                       â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10% (2)          â”‚
â”‚                                                     â”‚
â”‚  D. Cáº§n giáº£i thÃ­ch thÃªm                             â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10% (2)          â”‚
â”‚                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ÄÃ£ vote: 20/30 há»c sinh                           â”‚
â”‚                                                     â”‚
â”‚  [ğŸ‘ áº¨n/Hiá»‡n káº¿t quáº£]  [â¹ Káº¿t thÃºc]  [ğŸ“Š Xuáº¥t]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vote (Há»c sinh)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š BÃ¬nh chá»n tá»« GiÃ¡o viÃªn                     Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  CÃ¡c em Ä‘Ã£ hiá»ƒu bÃ i hÃ´m nay chÆ°a?                  â”‚
â”‚                                                     â”‚
â”‚  â—‹ A. Hiá»ƒu rÃµ                                      â”‚
â”‚  â— B. Hiá»ƒu má»™t pháº§n                                â”‚
â”‚  â—‹ C. ChÆ°a hiá»ƒu                                    â”‚
â”‚  â—‹ D. Cáº§n giáº£i thÃ­ch thÃªm                          â”‚
â”‚                                                     â”‚
â”‚                      [âœ“ Gá»­i Phiáº¿u báº§u]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Protocol Messages

| Code | Type       | MÃ´ táº£              |
|------|------------|--------------------|
| 0xB0 | PollCreate | Táº¡o poll má»›i       |
| 0xB1 | PollStart  | Báº¯t Ä‘áº§u poll       |
| 0xB2 | PollVote   | Gá»­i vote           |
| 0xB3 | PollResult | Káº¿t quáº£ realtime   |
| 0xB4 | PollClose  | Káº¿t thÃºc poll      |

## Payload Format

```json
// PollCreate
{
  "pollId": "uuid",
  "question": "CÃ¡c em Ä‘Ã£ hiá»ƒu bÃ i chÆ°a?",
  "options": [
    {"id": "opt-1", "text": "Hiá»ƒu rÃµ"},
    {"id": "opt-2", "text": "Hiá»ƒu má»™t pháº§n"}
  ],
  "type": "single",
  "showResults": true
}

// PollVote
{
  "pollId": "uuid",
  "studentId": "student-1",
  "selectedOptions": ["opt-1"]
}

// PollResult (broadcast)
{
  "pollId": "uuid",
  "totalVotes": 20,
  "results": {
    "opt-1": 11,
    "opt-2": 5,
    "opt-3": 2,
    "opt-4": 2
  }
}
```

## Database Tables

```sql
CREATE TABLE Polls (
    id TEXT PRIMARY KEY,
    session_id INTEGER,
    question TEXT NOT NULL,
    poll_type TEXT DEFAULT 'single',
    show_results INTEGER DEFAULT 1,
    is_active INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    closed_at DATETIME
);

CREATE TABLE PollOptions (
    id TEXT PRIMARY KEY,
    poll_id TEXT,
    option_text TEXT,
    vote_count INTEGER DEFAULT 0,
    FOREIGN KEY (poll_id) REFERENCES Polls(id)
);

CREATE TABLE PollVotes (
    poll_id TEXT,
    student_id TEXT,
    option_id TEXT,
    voted_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (poll_id, student_id, option_id)
);
```

## Realtime Update Flow

```
1. Há»c sinh vote
       â”‚
       â–¼
2. Server nháº­n vote, cáº­p nháº­t database
       â”‚
       â–¼
3. Server broadcast PollResult Ä‘áº¿n táº¥t cáº£
       â”‚
       â–¼
4. GiÃ¡o viÃªn: Cáº­p nháº­t biá»ƒu Ä‘á»“
   Há»c sinh: Cáº­p nháº­t káº¿t quáº£ (náº¿u showResults=true)
```

## Giá»›i háº¡n

| ThÃ´ng sá»‘              | GiÃ¡ trá»‹    |
|-----------------------|------------|
| Sá»‘ lá»±a chá»n tá»‘i Ä‘a    | 10         |
| Äá»™ dÃ i cÃ¢u há»i        | 500 kÃ½ tá»±  |
| Äá»™ dÃ i lá»±a chá»n       | 200 kÃ½ tá»±  |
| Sá»‘ poll Ä‘á»“ng thá»i     | 1          |

---

_Xem: [Workflow](../../.agent/workflows/new-features-development.md)_
